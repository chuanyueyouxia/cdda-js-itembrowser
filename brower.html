<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <style type="text/css">
  <!--
  BODY {
    margin: 0;
    padding: 0px 0px 0px 300px ; /* 左側の横サイズを 150 ピクセルとします */
    background-color : #000000;
  }
  * html body{
    overflow: auto;
  } 
  div {
    font-size: 14px;
  }
  div#Left_area {
    padding : 10px;
    position: fixed !important;
    position: absolute;
    top: 0;
    left: 0;
    width: 280px; /* BODY で設定した150ピクセルの値をセットします　*/
    height: 100%;
    /*background-color : #aaff66 ;*/
    overflow: auto; /* メニュー等の行が多い場合はスクロールバーを表示する */
  }
  div#Right_area{
    padding : 10px;
    background-color : #000000;
    color : #ffffff;
  }
  * html div#Right_area{
    height: 100%;
    overflow: auto;
  }

  a {
    color: #428bca;
    text-decoration: none;
  }
  a:hover,
  a:focus {
    color: #2a6496;
    text-decoration: underline;
  }
  a:focus {
    outline: thin dotted;
    outline: 5px auto -webkit-focus-ring-color;
    outline-offset: -2px;
  }
  --> 
  </style>
  <script src="jquery-3.0.0.min.js"></script>
  <script type="text/javascript" src="data.js"></script>
  <script type="text/javascript" src="cdda.js"></script>
  <script type="text/javascript" src="MaterialClass.js"></script>
  <script type="text/javascript" src="ItemClass.js"></script>
  <script type="text/javascript" src="RecipeClass.js"></script>
  <script type="text/javascript">
    var key_id = "";
    var mode = "show_item";

    function conv_to_array(obj){
      if(!Array.isArray(obj)){
        var new_array = [obj];
        return new_array;
      }
      return obj;
    }

    function item_data_html(id){
      var string_html = "";
      item_data = new ItemClass(id);
      console.log(item_data);
      string_html += "<h2><font color=" + item_data.getSymbolColor() + ">" + item_data.getSymbol() + "</font> " + item_data.getName() + "</h3>";
      string_html += "<p>";
      string_html += "id: " + item_data.getId() + "<br>";
      string_html += "容積: " + (item_data.getVolume() * 0.25) + " L<br>";
      string_html += "重量: " + (item_data.getWeight() * 0.001) + " kg<br>";
      string_html += "打撃: " + item_data.getBashing() + " ";
      string_html += "斬撃: " + item_data.getCutting() + " ";
      string_html += "命中ボーナス: " + item_data.getToHit() + "<br>";
      string_html += "攻撃コスト: " + item_data.getAtkCost() + "<br>";
      string_html += "素材: ";
      for(var mat of item_data.getMaterial()){
        if(mat){
          string_html += mat.getName() + ", ";
        }
      }
      string_html += "<br>";
      for(var q of item_data.getQualities()){
        if(q) {
          if(q[0]) {
            string_html += "レベル " + q[1] + " の " + q[0] + " 性能<br>";
          }
        }
      }
      console.log(item_data.isArmor());
      if(item_data.isArmor()) {
        string_html += "着用部位: ";
        for(var part of item_data.getCovers()) {
          string_html += part + ", ";
        }
        string_html += "<br>";
        string_html += "収納: " + (item_data.getStorage() * 0.25) + " L<br>";
        string_html += "動作制限: " + item_data.getEncumbrance() + " ";
        string_html += "暖かさ: " + item_data.getWarmth() + " ";
        string_html += "被覆率: " + item_data.getCoverage() + " %<br>";
        string_html += "打撃防御: " + item_data.getBashResist() + " ";
        string_html += "斬撃防御: " + item_data.getCutResist() + " <br>";
        string_html += "耐酸防御: " + item_data.getAcidResist() + " ";
        string_html += "耐火防御: " + item_data.getFireResist() + " <br>";
        string_html += "環境防護: " + item_data.getEnvironmentalProtection() + "<br>";
      }
      if(item_data.isConductive()) {
        string_html += "このアイテムは導電体です。<br>";
      } else {
        string_html += "このアイテムは絶縁体です。<br>";
      }
      string_html += item_data.getDescription() + "<br>";
      string_html += "</p>";
      return string_html;
    }

    function link_to_item(string, id){
      return '<a href=javascript:select_item("' + id + '")>' + string + '</a>';
    }

    function item_recipe_html(id){
      var string_html = "<h3>レシピ</h3>";
      var recipe_list = new RecipeListClass(id);
      string_html += "<p>";
      if(!recipe_list.getRecipe(0)){
        string_html += "レシピはありません。"
      }else{
        var recipe_data = recipe_list.getRecipe(0);
        string_html += "適用スキル: " + recipe_data.getSkillUsed() + "<br>";
        string_html += "必要スキル: ";
        if(recipe_data.getSkillsRequired()){
          for(var r of recipe_data.getSkillsRequired()){
            if(r[0]) {
              string_html += r[0] + "(" + r[1] + "), ";
            }
          }
        }
        string_html += "<br>";
        string_html += "難易度: " + recipe_data.getDifficulty() + "<br>";
        string_html += "完了まで " + (recipe_data.getTime() / 1000) + " 分<br>";
        for(var q of recipe_data.getQualities()) {
          string_html += "レベル " + q.level + " の " + q.id + " 性能<br>";
        }
        for(var t of recipe_data.getTools()) {
          for(var i = 0; i < t.length; ++i) {
            if(t[i][0]) {
              console.log(t[i][0]);
              var item = new ItemClass(t[i][0]);
              var charges = t[i][1];
              string_html += link_to_item(item.getName(), item.getId());
              string_html += charges != -1 ? "(充填量: " + charges + ")" : "";
              if(t.length - 1 > i) {
                string_html += " または ";
              }else{
                string_html += "<br>";
              }
            }
          }
        }
        for(var c of recipe_data.getComponents()){
          for(var i = 0; i < c.length; ++i){
            if(c[i][0]) {
              var item = new ItemClass(c[i][0]);
              var charges = c[i][1];
              string_html += charges + " 個の " + link_to_item(item.getName(), item.getId());
              if(c.length - 1 > i) {
                string_html += " または ";
              }else{
                string_html += "<br>";
              }
            }
          }
        }
        for(var b of recipe_data.getBookLearn()){
            var item = new ItemClass(b[0]);
            string_html += link_to_item(item.getName(), item.getId()) + " から適用スキルがレベル " + b[1] + " で習得します。<br>";
        }
        if(recipe_data.getAutolearn()) {
          string_html += "このレシピは必要スキルを満たしたときに自動で習得します。<br>";
        }
      }
      string_html += "</p>";
      return string_html;
    }

    function update_data(){
      $('#Right_area').empty();
      if(mode == "show_item"){
        var recipe_list = new RecipeListClass(key_id);
        var item_data = new ItemClass(key_id);
        console.log(JSON.stringify(item_data));
        console.log(JSON.stringify(recipe_list));

        $('#Right_area').append(item_data_html(key_id));
        $('#Right_area').append(item_recipe_html(key_id));
        $('#Right_area').append("<h3>JSON</h3>");
        $('#Right_area').append("<h4>Item</h3>");
        $('#Right_area').append(JSON.stringify(item_data.getJson()));
        $('#Right_area').append("<h4>Recipes</h3>");
        var i = 0;
        r = recipe_list.getRecipe(i);
        while (r) {
          $('#Right_area').append(JSON.stringify(r.getJson()));
          i++;
          r = recipe_list.getRecipe(i);
        }
      }
    }

    function select_item(key){
      key_id = key;
      update_data();
    }

    function search_data(){
      var hoge = search.textbox.value;
      $('#search_result').empty()
      for(var item of items){
        if(item.name && item.id && hoge){
          if(item.name.indexOf(hoge) != -1){
            $('#search_result').append(
              '<a href=javascript:select_item("' + item.id + '")>' + item.name + '</a><br>'
              );
          }
        }
      }
    }
  </script>
  <script type="text/javascript">
  </script>
</head>
<body>

<div id="Left_area">
  <form name="search">
    <input type="text" name="textbox" onkeyup="search_data()" placeholder="検索キーワードを入力してください">
  </form>
  <div id="search_result">
  </div>
</div>
<div id="Right_area">
</div>
</body>
</html>
